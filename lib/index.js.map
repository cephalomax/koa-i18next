{"version":3,"file":"index.js","sources":["../src/detect.js","../src/index.js"],"sourcesContent":["const debug = require('debug')('koa:i18next')\n\nconst DEFAULT_ORDER = ['querystring', 'cookie', 'header']\n\nconst detectors = {\n  cookie: function (context, options) {\n    let cookie = options.lookupCookie || 'i18next'\n    return context.cookies.get(cookie)\n  },\n\n  // fork from i18next-express-middleware\n  header: function (context) {\n    let acceptLanguage = context.get('accept-language')\n    let found\n    let locales = []\n    if (acceptLanguage) {\n      let lngs = []\n\n      // associate language tags by their 'q' value (between 1 and 0)\n      acceptLanguage.split(',').forEach(function (l) {\n        let parts = l.split(';') // 'en-GB;q=0.8' -> ['en-GB', 'q=0.8']\n\n        // get the language tag qvalue: 'q=0.8' -> 0.8\n        let qvalue = 1 // default qvalue\n\n        for (let i = 0; i < parts.length; i++) {\n          let part = parts[i].split('=')\n          if (part[0] === 'q' && !isNaN(part[1])) {\n            qvalue = Number(part[1])\n            break\n          }\n        }\n        // add the tag and primary subtag to the qvalue associations\n        lngs.push({\n          lng: parts[0],\n          q: qvalue\n        })\n      })\n\n      lngs.sort(function (a, b) {\n        return b.q - a.q\n      })\n\n      for (let i = 0; i < lngs.length; i++) {\n        locales.push(lngs[i].lng)\n      }\n\n      if (locales.length) found = locales\n    }\n\n    return found\n  },\n  path: function (context, options) {\n    let found\n\n    if (options.lookupPath !== undefined && context.params) {\n      found = context.params[options.lookupPath]\n    }\n\n    if (!found && options.lookupFromPathIndex !== undefined) {\n      let parts = context.path.split('/')\n      if (parts[0] === '') { // Handle paths that start with a slash, i.e., '/foo' -> ['', 'foo']\n        parts.shift()\n      }\n\n      if (parts.length > options.lookupFromPathIndex) {\n        found = parts[options.lookupFromPathIndex]\n      }\n    }\n    return found\n  },\n  querystring: function (context, options) {\n    let name = options.lookupQuerystring || 'lng'\n    return context.query[name]\n  },\n\n  session: function (context, options) {\n    let name = options.lookupSession || 'lng'\n    return context.session && context.session[name]\n  }\n}\n\nexport default function (context, options = {}) {\n  let { order, fallback } = options\n  order = order && Array.isArray(order)\n    ? order\n    : DEFAULT_ORDER\n\n  let lngs = []\n\n  for (let i = 0, len = order.length; i < len; i++) {\n    let detector = detectors[order[i]]\n    let lng\n    if (detector) {\n      lng = detector(context, options)\n    }\n    if (lng && typeof lng === 'string') {\n      lngs.push(lng)\n    } else {\n      lngs = lngs.concat(lng)\n    }\n  }\n  let found\n  for (let i = 0, len = lngs.length; i < len; i++) {\n    let cleanedLng = context.i18next.services.languageUtils.formatLanguageCode(lngs[i])\n    if (context.i18next.services.languageUtils.isWhitelisted(cleanedLng)) found = cleanedLng\n    if (found) break\n  }\n\n  return found || fallback\n}\n","import detect from './detect'\n\nconst debug = require('debug')('koa:i18next')\n\nexport default function koaI18next(i18next, options = {}) {\n\n  return async function i18nextMiddleware(ctx, next) {\n    ctx.i18next = i18next\n    let {\n      lookupCookie,\n      lookupSession\n    } = options\n\n    let lng = detect(ctx, options)\n    lng && setLanguage(ctx, lng, options)\n\n    debug('language is', lng)\n\n    ctx.t = function (...args) {\n      let key\n      let opts\n      // do detect path\n      if (!lng && isDetectPath(options.order)) {\n        lng = detect(ctx, Object.assign(options, { order: ['path'] }))\n        lng && setLanguage(ctx, lng, options)\n      }\n\n      if (args.length === 1) {\n        args.push({})\n      }\n\n      for (let i = 0, len = args.length; i < len; i++) {\n        let arg = args[i]\n        if (typeof arg === 'object' && !Array.isArray(arg)) {\n          arg.lng = lng\n        }\n      }\n      return i18next.t.apply(i18next, args)\n    }\n\n    await next()\n  }\n}\n\n\nfunction setPath(object, path, newValue) {\n  let stack;\n  if (typeof path !== \"string\") stack = [].concat(path);\n  if (typeof path === \"string\") stack = path.split(\".\");\n\n  while (stack.length > 1) {\n    let key = stack.shift();\n    if (key.indexOf(\"###\") > -1) key = key.replace(/###/g, \".\");\n    if (!object[key]) object[key] = {};\n    object = object[key];\n  }\n\n  let key = stack.shift();\n  if (key.indexOf(\"###\") > -1) key = key.replace(/###/g, \".\");\n  object[key] = newValue;\n}\n\nkoaI18next.getResourcesHandler = function (i18next, options) {\n  options = options || {};\n  let maxAge = options.maxAge || 60 * 60 * 24 * 30;\n  const propertyParam = options.propertyParam || 'query';\n\n  return async function (ctx, next) {\n    if (options.path && ctx.path !== options.path) {\n      return await next();\n    }\n    if (!i18next.services.backendConnector) return ctx.throw(404, \"koa-i18next-middleware:: no backend configured\");\n\n    let resources = {};\n\n    ctx.type = \"json\";\n    if (options.cache !== undefined ? options.cache : process.env.NODE_ENV === \"production\") {\n      ctx.set(\"Cache-Control\", \"public, max-age=\" + maxAge);\n      ctx.set(\"Expires\", new Date(new Date().getTime() + maxAge * 1000).toUTCString());\n    } else {\n      ctx.set(\"Pragma\", \"no-cache\");\n      ctx.set(\"Cache-Control\", \"no-cache\");\n    }\n\n    let languages = ctx[propertyParam][options.lngParam || \"lng\"] ? ctx[propertyParam][options.lngParam || \"lng\"].split(\" \") : [];\n    let namespaces = ctx[propertyParam][options.nsParam || \"ns\"] ? ctx[propertyParam][options.nsParam || \"ns\"].split(\" \") : [];\n\n    // extend ns\n    namespaces.forEach(ns => {\n      if (i18next.options.ns && i18next.options.ns.indexOf(ns) < 0) i18next.options.ns.push(ns);\n    });\n\n    i18next.services.backendConnector.load(languages, namespaces, function () {\n      languages.forEach(lng => {\n        namespaces.forEach(ns => {\n          setPath(resources, [lng, ns], i18next.getResourceBundle(lng, ns));\n        });\n      });\n      ctx.body = resources;\n    });\n  };\n}\n\nkoaI18next.getMissingKeyHandler = function (i18next, options) {\n  options = options || {};\n  const propertyParam = options.propertyParam || 'query';\n\n  return async function (ctx, next) {\n    if (options.path && ctx.path !== options.path) {\n      return await next();\n    }\n    let lng = ctx[propertyParam][options.lngParam || \"lng\"];\n    let ns = ctx[propertyParam][options.nsParam || \"ns\"];\n\n    if (!i18next.services.backendConnector) return ctx.throw(404, \"koa-i18next-middleware:: no backend configured\");\n\n    for (var m in ctx.request.body) {\n      i18next.services.backendConnector.saveMissing([lng], ns, m, ctx.request.body[m]);\n    }\n    ctx.body = \"ok\";\n  };\n}\n\nfunction isDetectPath(order = []) {\n  return order.indexOf('path') !== -1\n}\n\nfunction setLanguage(context, lng, options = {}) {\n  const {\n    lookupCookie\n    , lookupCookieDomain\n    , lookupPath\n    , lookupSession\n  } = options\n  context.locals = Object.assign(context.locals || {}, { lng })\n  context.state = Object.assign(context.state || {}, { lng })\n  context.language = context.lng = lng\n  context.set('content-language', lng)\n  if (lookupCookie) {\n    context.cookies.set(lookupCookie, lng, { httpOnly: false, signed: false, domain: lookupCookieDomain });\n  }\n  if (lookupSession && context.session) {\n    context.session[lookupSession] = lng\n  }\n}\n"],"names":["debug"],"mappings":"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"}